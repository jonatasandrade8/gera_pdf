<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador Simplificado de Nota PF</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/vfs_fonts.js"></script>
    
    <style>
        /* CSS SIMPLIFICADO */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .form-section { background-color: #ffffff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); }
        .header h1 { color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 5px; color: #555; }
        
        input[type="text"], input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
        input:focus { border-color: #3498db; outline: none; box-shadow: 0 0 5px rgba(52, 152, 219, 0.5); }

        .row { display: flex; gap: 15px; }
        .row .form-group { flex: 1; }
        
        /* Bot√µes */
        .btn { display: block; width: 100%; padding: 12px; margin: 15px 0; border: none; border-radius: 4px; font-size: 1.1rem; cursor: pointer; font-weight: 700; transition: background-color 0.3s; }
        .btn-add { background-color: #2ecc71; color: white; }
        .btn-add:hover { background-color: #27ae60; }
        .btn-pdf { background-color: #3498db; color: white; }
        .btn-pdf:hover { background-color: #2980b9; }

        /* Pr√©via da Nota (Tabela) */
        .document-preview { background-color: #ffffff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); min-height: 400px; position: sticky; top: 20px; }
        .preview-header { margin-bottom: 20px; }
        .preview-header h3 { color: #2980b9; }
        .preview-header p { font-size: 1.1rem; color: #7f8c8d; }

        .items-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .items-table th, .items-table td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        .items-table th { background-color: #ecf0f1; font-weight: 700; }
        .items-table tfoot td { font-size: 1.3rem; font-weight: 700; background-color: #d1e7dd; color: #27ae60; border-top: 2px solid #27ae60; }

        .remove-btn { background-color: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .remove-btn:hover { background-color: #c0392b; }
    </style>
</head>
<body>
    
    <div class="container">
        
        <div class="form-section">
            <div class="header">
                <h1>‚úçÔ∏è Dados da Nota (Pessoa F√≠sica)</h1>
            </div>

            <div class="form-group">
                <label>Nome Completo (Recebedor) *</label>
                <input type="text" id="recebedor-nome" placeholder="Ex: Jo√£o da Silva" oninput="renderPreview()">
            </div>
            
            <div class="form-group">
                <label>T√≠tulo da Nota *</label>
                <input type="text" id="nota-titulo" placeholder="Ex: Cobran√ßa de Servi√ßos de Consultoria - Janeiro" oninput="renderPreview()">
            </div>

            <h2>‚ûï Adicionar Item</h2>
            <div class="row">
                <div class="form-group" style="flex: 2;">
                    <label>Descri√ß√£o do Item</label>
                    <input type="text" id="item-descricao" placeholder="Servi√ßo, Produto ou Desconto">
                </div>
                <div class="form-group">
                    <label>Valor (R$)</label>
                    <input type="number" id="item-valor" placeholder="0.00" min="0" step="0.01">
                </div>
            </div>

            <button class="btn btn-add" onclick="addItem()">+ Adicionar √† Nota</button>

            <button class="btn btn-pdf" onclick="gerarPDF()">üì• Baixar PDF</button>

        </div>

        <div class="document-preview">
            <div class="preview-header">
                <h2>Pr√©via da Nota</h2>
                <h3 id="preview-titulo">T√≠tulo da Nota</h3>
                <p>Emitido por: <span id="preview-recebedor-nome">Nome do Recebedor</span></p>
            </div>
            
            <div id="preview-content">
                <p style="text-align: center; color: #999; padding-top: 50px;">Adicione itens para ver a pr√©via.</p>
            </div>
        </div>
    </div>

    <script>
        // JS SIMPLIFICADO
        let items = []; // Armazenar√° { descricao, valor }

        // --- FUN√á√ïES DE FORMATAC√ÉO ---

        function formatarParaMoeda(valor) {
            // Formata√ß√£o BRL (R$)
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2
            }).format(valor);
        }

        function calculateTotal() {
            return items.reduce((sum, item) => sum + item.valor, 0);
        }

        // --- GEST√ÉO DE ITENS ---

        function addItem() {
            const descricaoInput = document.getElementById('item-descricao');
            const valorInput = document.getElementById('item-valor');

            const descricao = descricaoInput.value.trim();
            const valor = parseFloat(valorInput.value);

            if (!descricao || isNaN(valor) || valor <= 0) {
                alert("Por favor, preencha a descri√ß√£o e um valor v√°lido.");
                return;
            }

            items.push({ descricao, valor });
            
            // Limpar inputs
            descricaoInput.value = '';
            valorInput.value = '';

            renderPreview();
        }

        function removeItem(index) {
            items.splice(index, 1);
            renderPreview();
        }

        // --- PR√âVIA DO DOCUMENTO ---

        function renderPreview() {
            const previewContainer = document.getElementById('preview-content');
            const recebedorNome = document.getElementById('recebedor-nome').value || 'Nome do Recebedor';
            const notaTitulo = document.getElementById('nota-titulo').value || 'T√≠tulo da Nota';

            document.getElementById('preview-recebedor-nome').innerText = recebedorNome;
            document.getElementById('preview-titulo').innerText = notaTitulo;

            if (items.length === 0) {
                previewContainer.innerHTML = '<p style="text-align: center; color: #999; padding-top: 50px;">Adicione itens para ver a pr√©via.</p>';
                return;
            }

            const total = calculateTotal();

            let tableHTML = `
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>DESCRI√á√ÉO</th>
                            <th style="text-align: right;">VALOR</th>
                            <th>A√á√ÉO</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            items.forEach((item, index) => {
                tableHTML += `
                    <tr>
                        <td>${item.descricao}</td>
                        <td style="text-align: right;">${formatarParaMoeda(item.valor)}</td>
                        <td><button class="remove-btn" onclick="removeItem(${index})">Remover</button></td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2" style="text-align: right; padding-right: 10px;">TOTAL L√çQUIDO:</td>
                            <td colspan="1">${formatarParaMoeda(total)}</td>
                        </tr>
                    </tfoot>
                </table>
            `;

            previewContainer.innerHTML = tableHTML;
        }

        // Garante que a pr√©via inicial esteja correta
        document.addEventListener('DOMContentLoaded', renderPreview);
        
        // --- GERA√á√ÉO DO PDF (PDFMake) ---

        function gerarPDF() {
            const recebedorNome = document.getElementById('recebedor-nome').value.trim();
            const notaTitulo = document.getElementById('nota-titulo').value.trim();
            
            if (!recebedorNome || !notaTitulo || items.length === 0) {
                alert("Por favor, preencha o Nome, o T√≠tulo da Nota e adicione pelo menos um item.");
                return;
            }

            const total = calculateTotal();
            const dataAtual = new Date().toLocaleDateString('pt-BR');

            // Corpo da tabela de itens para o PDF
            const tableBody = [
                [{ text: 'DESCRI√á√ÉO', style: 'tableHeader' }, { text: 'VALOR (R$)', style: 'tableHeader', alignment: 'right' }],
            ];

            items.forEach(item => {
                tableBody.push([
                    { text: item.descricao, fontSize: 10 },
                    { text: formatarParaMoeda(item.valor).replace('R$', '').trim(), alignment: 'right', fontSize: 10 }
                ]);
            });

            // Linha de Total
            tableBody.push([
                { text: 'TOTAL L√çQUIDO', style: 'totalFinalLabel', fillColor: '#d1e7dd', alignment: 'right' },
                { text: formatarParaMoeda(total).replace('R$', '').trim(), style: 'totalFinalAmount', fillColor: '#d1e7dd', color: '#27ae60' }
            ]);

            const docDefinition = {
                pageSize: 'A4',
                pageMargins: [40, 40, 40, 40],
                content: [
                    { text: 'NOTA DE VALORES A RECEBER', style: 'header', alignment: 'center', margin: [0, 0, 0, 10] },
                    { text: notaTitulo, style: 'subheader', alignment: 'center', margin: [0, 0, 0, 20] },
                    
                    { 
                        text: [
                            { text: 'EMISSOR:\n', bold: true },
                            { text: recebedorNome + ' (Pessoa F√≠sica)\n', fontSize: 11 },
                            { text: 'Data de Emiss√£o: ' + dataAtual, fontSize: 10 }
                        ],
                        alignment: 'left',
                        margin: [0, 0, 0, 20]
                    },

                    // Tabela de Itens
                    {
                        table: {
                            headerRows: 1,
                            widths: ['*', 100],
                            body: tableBody
                        },
                        layout: {
                            hLineWidth: (i, node) => (i === 0 || i === node.table.body.length) ? 1 : 0.5,
                            vLineWidth: (i, node) => 0.5,
                            hLineColor: (i, node) => (i === 0 || i === node.table.body.length) ? '#999' : '#eee',
                            vLineColor: (i, node) => '#eee',
                        },
                        margin: [0, 5, 0, 30]
                    },

                    // Linha de Assinatura
                    {
                        text: '___________________________________\n' + recebedorNome, 
                        alignment: 'center', 
                        style: 'assinaturaNome', 
                        margin: [0, 50, 0, 0]
                    },
                ].filter(Boolean),

                // Estilos PDFMake
                styles: {
                    header: { fontSize: 22, bold: true, color: '#2c3e50' },
                    subheader: { fontSize: 16, bold: false, color: '#34495e' },
                    tableHeader: { bold: true, fontSize: 10, color: '#FFFFFF', fillColor: '#34495e', alignment: 'left', padding: [5, 2] },
                    totalFinalLabel: { fontSize: 12, bold: true, color: '#2c3e50', padding: [5, 2] },
                    totalFinalAmount: { fontSize: 14, bold: true, padding: [5, 2] },
                    assinaturaNome: { fontSize: 10, color: '#555', margin: [0, 5, 0, 0] },
                },
                defaultStyle: { font: 'Roboto' }
            };

            // 4. Gerar o PDF
            pdfMake.createPdf(docDefinition).download(`Nota_${recebedorNome.split(' ')[0]}_${dataAtual.replace(/\//g, '-')}.pdf`);
        }
    </script>
</body>
</html>